## 服务发现

这是本电子书的第四章，一本关于使用微服务构建应用程序的电子书。章节一介绍了微服务架构模式，讨论了使用微服务的优缺点。章节二和章节三，阐述了微服务之间通信不同的层面。在本章节中，我们探讨与服务发现密切相关的问题。

### 为什么使用服务发现
让我们想象下您正在编写代码来调用具有REST API或Thrift API的服务。为了发起请求，你的代码需要知道服务实例的网络位置（IP地址和端口）。在物理硬件上运行的传统应用程序中，服务实例的网络地址相对是静态的。比如，你的代码可以从偶尔更新的配置文件中读取网址地址。

但是，在基于云的现代微服务应用程序中，这是一个更难以解决的问题，如图4-1所示。
![4-1](4-1.png)
图4-1 客户端或者API Gateway需要帮助来查找服务。

服务实例拥有东岱分配的网络地址。而且，由于伸缩，失败与升级，服务实例的集合会动态改变。最终，你的客户端代码需要使用一个更精细的服务发现机制。

主要有两种服务发现模式：客户端发现与服务器端发现。首先让我们查看客户端发现。

### 客户端服务发现模式
当使用客户端服务发现模式，客户端负责确定可用服务实例的网络位置以及跨实例负载均衡请求。客户端查询服务注册中心，可用服务实例的数据库。客户端使用负载均衡算法选择其中的一台可用服务实例，然后发起请求。
图4-2 展示了该模式的结构
![4-2](4-2.png)
图4-2 客户端可以承担发现服务的任务

当服务实例启动的时，它网络位置会登记到服务注册中心。当实例终止时，服务注册中心将删除该服务实例。通常使用心跳机制定期刷新服务实例的注册。

Netflix OSS为客户端服务发现模式提供了一个优秀的例子。Netflix Eureka是一个服务注册中心。它提供了一个REST API，用于管理服务实例注册和查询可用实例。Netflix Ribbon是一个IPC客户端，与Eureka一起使用将请求负载均衡到可用的服务实例中。在后续的章节中我们将深入讨论Eureka。

服务端发现模式有很多优点和缺点。这种模式相对简单，除了服务注册中心以外，没有其他移动部分。同样，由于客户端知道可以服务实例，就可以发起只能，特定与应用程序的负载均衡决定，比如使用hash一致。该模式的一个显著缺点是将服务注册中心与客户端进行了耦合。你必须为你服务客户端所使用的每一种语言与框架实现客户端服务发现逻辑。

现在我们已经看过了客户端发现，让我们剖析服务器端发现。

